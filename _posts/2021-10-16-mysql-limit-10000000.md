---
title: MySQL 千万级 limit 优化方案
key: 2021-10-16
tags: mysql limit
---



MySQL 的索引已经可以支持很大的数据量了。慢是因为 limit 需要向后搜索， 搜索的越多越慢（我猜的）。经过实践，总结一下比较好的 limit 分页优化方案。

<!--more-->

## 方案

### 1. 取出每次最大的 ID, 然后 where 这个 ID

```sql
-- 正序
select * from table_name where id > 最大id limit 10， 10；

-- 倒序未优化写法：
select id from t order by id desc limit 8000000,10;

-- 倒序优化写法：
select * from table_name where id <= (
    (select max(id) from t) - 8000000) order by id desc limit 10;
```

这种方法适用于：除了主键ID等离散型字段外，也适用连续型字段 datetime 等

>  最大 ID 由前端分页 pageNum 和 pageIndex 计算出来。



### 2.  IN获取id

```sql
select * from table_name where id in (
    select id from table_name where ( user = xxx )) limit 10, 10;
```



### 3. join方式 + 覆盖索引（推荐）

```sql
select * from table_name inner join (
    select id from table_name where (user = xxx) limit 10000,10) b using (id)
```



> 如果对于有where 条件，又想走索引用limit的，必须设计一个索引，将where 放第一位，limit用到的主键放第2位，而且只能select 主键！



```sql
select id from table_name where pid = 1 limit 100000,10;
-- 创建索引：
alter table table_name add index idx_pid_id(pid, id)
```

just  so so .

## 参考

- [https://blog.csdn.net/sunct/article/details/90441965](https://blog.csdn.net/sunct/article/details/90441965)
- [https://blog.csdn.net/maidou2917/article/details/106411503/?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.no_search_link&spm=1001.2101.3001.4242](https://blog.csdn.net/maidou2917/article/details/106411503/?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.no_search_link&spm=1001.2101.3001.4242)

EOF
